#  智能指针（RAII）

##  概念

1.RAII

2.支持像指针一样使用

3.拷贝问题

##  C++为什么没有垃圾回收机制？

1.垃圾回收机制会降低性能，因为C/C++本身注重性能

gc是java中垃圾回收机制

##  为什么会有智能指针

假如在new和delete中间出现了异常，那么就可能直接就跳过了delete，这时候就会出现内存泄漏。

##  RAII

RAII不等同于智能指针

RAII他是智能指针的技术原理，是智能指针的一个指导思想。

![image-20230816160253096](E:\markdown\图片\image-20230816160253096.png)

获取到资源后去初始化一个对象，将资源交给对象管理。

以下是简单的智能指针的代码



```C++
#pragma once

namespace csq
{
    template<class T>
    class SmartPtr
    {
    public:
        SmartPtr(T* ptr)
            :_ptr(ptr)
        {}

        ~SmartPtr()
        {
            cout << "delete:" << ptr << endl;
            delete[] _ptr;
        }

        T& operator*()
        {
            return *_Ptr;
        }
        T* operator->()
        {
            return _ptr;
        }
    private:
        T* _ptr;

    };
} 
```

​    

##  智能指针如何拷贝？

auto_ptr

##  boost库的发展历史

像右值引用，智能指针，C++都是吸收boost库中的这些东西诞生的。

boost中有scoped_ptr, shared_ptr, weak_ptr;

  

##  unique_ptr原理和使用

原理：

禁止拷贝

unique_ptr原理就是直接不让拷贝。防止拷贝，这样就解决了智能指针的拷贝问题。



  ##  shared_ptr原理

支持拷贝，

核心原理就是引用计数，记录几个对象管理这块资源，

析构的时候--计数，最后一个析构的对象释放资源。

   

##  weak_ptr

专门辅助解决shared_ptr循环引用

##  定制删除器

 

 
