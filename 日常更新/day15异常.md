

#  异常

##  C语言处理错误的方式

1.终止程序。

2.返回错误码

## C++ 异常概念

当一个函数发现自己无法处理的错误时就可以抛出异常，让**函数的直接或间接的调用者处理这个错误。**

异常的三个关键字。

throw:发现异常，抛异常

catch：捕获异常，可以又多个catch块

try：try块，后面配合catch

##  异常的规则

1.异常抛出的对象和catch捕获的对象类型需要相同

2.会先匹配**类型匹配，且离抛出位置最近**的那一个

##  异常栈展开规则

1.先检查throw本身是否在try块中，如果是则查找catch匹配。没有则跳到有catch的地方处理。

2.如果到达main函数栈，依旧没有匹配的，则终止程序。

3.找到匹配的catch子句并处理后，会继续沿着catch子句后面继续执行。

##  捕获所有异常

捕获没有匹配的任意类型的异常，但是不知道是谁的。

 不知道异常错误是什么。

```
catch(...)
{
	couture << "未知异常“；
}
```

## 抛派生类对象，用基类捕获(常用)、

 以下一个new抛异常的例子。

```C++
int main()
{
    try
    {
        size_t i = 0;
        while(1)
        {
            int* myarray = new int[1024*100*100];
            cout << myarray << "->" << i++ <<endl; 

        }
    }
    catch(const exception& ba)
    {
        cerr << "异常" << ba.what() << endl;
    }
}
```

还可以重写基类的虚函数，比如what(),这样可以自定义异常来进行报错。

##  捕获异常后还可以重新抛出



![image-20230816123254711](E:\markdown\图片\image-20230816123254711.png)

##  异常的缺陷(内存泄漏)

![image-20230816123821519](E:\markdown\图片\image-20230816123821519.png)

**解决直接跳到catch然而错过delete[ ]的情况，就在new和delete中间加上try catch**

![image-20230816124223080](E:\markdown\图片\image-20230816124223080.png) 

##  noexcept

![image-20230816144454847](E:\markdown\图片\image-20230816144454847.png)

#  异常的优缺点

##  优点

1.清晰准确的显示出错误的各种信息，可以更好的找出bug

2.相比错误码的层层返回，异常可以直接跳转到catch的地方。

3.很多第三方库，gtest和gmock等库，都用了一场

4.部分函数特别适合异常，比如T& operator[ ] 这些抛异常比较合适。

##  缺点

1.执行流乱跳，分析程序比较困难

2.C++没有垃圾回收机制，容易导致内存泄漏，死锁等问题。

3.异常尽量规范使用。
